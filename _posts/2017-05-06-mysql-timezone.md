---
layout: post
title: MySQL Time Zone
date: 2017-05-06 22:00:00 +0800
tags:
- mysql
---

æœ€è¿‘é‡åˆ° MySQL æ˜¾ç¤º timestamp çš„é—®é¢˜ï¼Œå¾€ä¸€ä¸ªè¡¨é‡Œæ’å…¥æ¡ç›®æˆ–æ›´æ–°æ¡ç›®çš„æ—¶å€™éƒ½éœ€è¦è®°å½•æ—¶é—´ï¼Œè®°å½•çš„è¿‡ç¨‹å¾€å¾€æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†å–æ•°æ®è¿›è¡Œå±•ç¤ºçš„æ—¶å€™å°±ä¼šæœ‰é—®é¢˜äº†ã€‚

åƒ Facebook è¿™æ ·çš„å¤§å…¬å¸ï¼Œä¸ºäº†å®¹ç¾ï¼Œæ•°æ®ä¼šå­˜å‚¨åœ¨å¤šä¸ªåœ°åŒºï¼Œèº«å¤„ ðŸ‡¬ðŸ‡§ çš„ Alice å‘å¸ƒäº†ä¸€æ¡çŠ¶æ€ï¼Œä¼šåœ¨æ¬§æ´²å’ŒåŒ—ç¾Žçš„æ•°æ®ä¸­å¿ƒéƒ½å­˜å‚¨ä¸€ä»½ã€‚ä¸ºäº†ç”¨æˆ·ä½“éªŒï¼ŒAlice ðŸ‡ºðŸ‡¸ çš„æœ‹å‹ Bob åœ¨é˜…è¯»è¿™æ¡çŠ¶æ€çš„æ—¶å€™ï¼Œåº”è¯¥å°†æ—¶é—´æ˜¾ç¤ºä¸ºç¾Žå›½æ—¶åŒºã€‚

**è€ƒè™‘ä¸¤ç§æƒ…å†µï¼š**

1ï¸âƒ£ Facebook æ¬§æ´²å’ŒåŒ—ç¾Žæ•°æ®ä¸­å¿ƒçš„æœºå™¨éƒ½å°†æ—¶åŒºè®¾ç½®ä¸º UTCï¼Œè¿™æ ·å½“ä½¿ç”¨ MySQL çš„ select è¯­å¥è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™æ˜¾ç¤ºçš„å­—ç¬¦ä¸²éƒ½ä¸º UTC æ—¶é—´ï¼Œä¸åŒåœ°åŒºçš„ç”¨æˆ·åœ¨æ˜¾ç¤ºçš„æ—¶å€™å¯ä»¥å°†è¿™ä¸ªæ—¶é—´å­—ç¬¦ä¸²è½¬æ¢ä¸ºå½“åœ°çš„æ—¶é—´ã€‚

2ï¸âƒ£ Facebook åœ¨æ¬§æ´²çš„æœºå™¨å’ŒåŒ—ç¾Žçš„æœºå™¨æ—¶åŒºä¸åŒï¼Œéƒ½ä¸ºå½“åœ°æ—¶åŒºï¼Œé‚£ä¹ˆå½“ä½¿ç”¨ select è¯­å¥è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™æ˜¾ç¤ºçš„éƒ½æ˜¯å½“åœ°æ—¶é—´ã€‚é‚£ä¹ˆï¼Œå‡è®¾åŒ—ç¾Žçš„æ•°æ®ä¸­å¿ƒæŒ‚äº†ï¼Œé‚£ä¹ˆèº«å¤„ ðŸ‡ºðŸ‡¸ çš„ Bob èŽ·å–åˆ°çš„æ˜¯æ¬§æ´²æ•°æ®ä¸­å¿ƒçš„æ•°æ®ï¼Œè¿™æ—¶å€™å¦‚æžœä¸å¯¹æ•°æ®è¿›è¡Œå¤„ç†å°±ä¼šæ˜¾ç¤ºé”™è¯¯çš„æ—¶é—´ã€‚

è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨ MySQL çš„ `CONVERT_TZ(dt, from_tz, to_tz)` è¿›è¡Œå¤„ç†ï¼š

```
mysql> select * from app;
+----+----------+---------------+----------+---------------------+---------------------+
| id | name     | display_name  | platform | create_date         | update_date         |
+----+----------+---------------+----------+---------------------+---------------------+
|  1 | testApp1 | I am test 1   | ISO      | 2017-05-10 05:49:42 | 2017-05-10 05:49:42 |
|  2 | testApp2 | I am test 2   | ANDROID  | 2017-05-10 05:49:42 | 2017-05-10 05:49:42 |
|  3 | testApp3 | I am test 3   | STB      | 2017-05-10 05:49:42 | 2017-05-10 05:49:42 |
+----+----------+---------------+----------+---------------------+---------------------+
4 rows in set (0.00 sec)
mysql> select id, name, display_name, platform, CONVERT_TZ(create_date, @@global.time_zone, '+1:00') as create_date from app;
+----+----------+---------------+----------+---------------------+
| id | name     | display_name  | platform | create_date         |
+----+----------+---------------+----------+---------------------+
|  1 | testApp1 | I am test 1   | ISO      | 2017-05-10 13:49:42 |
|  2 | testApp2 | I am test 2   | ANDROID  | 2017-05-10 13:49:42 |
|  3 | testApp3 | I am test 3   | STB      | 2017-05-10 13:49:42 |
+----+----------+---------------+----------+---------------------+
4 rows in set (0.01 sec)
```

è¿™å°±éœ€è¦åŽå°ç¨‹åºæ ¹æ®ç”¨æˆ·çš„æ—¶åŒºåˆ›å»ºåŒ…å« CONVERT_TZ çš„ SQL è¯­å¥è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åŽå°†ç»“æžœè¿”å›žç»™å‰ç«¯ã€‚

å½“ç„¶ Facebook è‚¯å®šä¸ä¼šä½¿ç”¨æˆ‘æè¿°çš„æ–¹æ³•ï¼Œè¿™é‡Œåªæ˜¯ä¸¾ä¾‹è¿›è¡Œæ—¶åŒºçš„è¯´æ˜Žã€‚

**Tips:**

MySQL å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯æ—¶é—´æˆ³ï¼ˆè‡ªæ ¼æž—å°¼æ²»æ—¶é—´1970-01-01é›¶ç‚¹è‡³ä»Šçš„ç§’æ•°ï¼‰ï¼Œåªä¸è¿‡ select æ—¶æ˜¾ç¤ºæ˜¯æ ¹æ®æ—¶åŒºè¿›è¡Œè½¬åŒ–çš„ã€‚

è®¾ç½® MySQL çš„æ—¶åŒºæœ‰ä¸¤ç§æ–¹å¼ï¼š

è®¾ç½®æœºå™¨æ—¶åŒº:

```shell
timedatectl list-timezones
timedatectl set-timezone UTC
```

è®¾ç½® MySQL æ—¶é—´æˆ³:

```
mysql> SET GLOBAL time_zone = '+00:00';
```

<br>
<span class="post-meta">
Reference:
</span>
<br>
<span class="post-meta">
1 [CONVERT_TZ][ref1]<br>
2 [MySQL Server Time Zone Support][ref2]<br>
3 [How do I set the time zone of MySQL?][ref3]
</span>

[ref1]: https://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html#function_convert-tz
[ref2]: https://dev.mysql.com/doc/refman/5.7/en//time-zone-support.html
[ref3]: http://stackoverflow.com/questions/930900/how-do-i-set-the-time-zone-of-mysql
